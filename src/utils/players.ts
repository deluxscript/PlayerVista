import { Player } from '../api'

export const footballEventsData: EventData[] = [
  {
    playerId: '660cb5defc583ff6b9a1ba9d',
    jerseyNumber: 10,
    name: 'Bashorun Ga',
    position: 'Midfielder',
    minutePlayed: 90,
    location: [
      {
        'x': 30,
        'y': 60,
      },
      {
        'x': 30,
        'y': 60,
      },
      {
        'x': 29.88671875,
        'y': 50,
      },
      {
        'x': 28.90234375,
        'y': 70,
      },
      {
        'x': 26.48046875,
        'y': 32,
      },
      {
        'x': 12.5234375,
        'y': 32,
      },
      {
        'x': 17.6484375,
        'y': 32,
      },
      {
        'x': 12.93359375,
        'y': 20,
      },
      {
        'x': 30,
        'y': 60,
      },
      {
        'x': 30,
        'y': 60,
      },
      {
        'x': 29.88671875,
        'y': 50,
      },
      {
        'x': 28.90234375,
        'y': 70,
      },
      {
        'x': 26.48046875,
        'y': 32,
      },
      {
        'x': 12.5234375,
        'y': 32,
      },
      {
        'x': 17.6484375,
        'y': 32,
      },
      {
        'x': 12.93359375,
        'y': 20,
      },
      {
        'x': 10.45703125,
        'y': 20,
      },
      {
        'x': 16.328125,
        'y': 32,
      },
      {
        'x': 13.10546875,
        'y': 32,
      },
    ],
    actions: {
      shots: [
        {
          type: 'shotsOnTarget',
          x: 0.7, // X position of the shot attempt
          y: 0.2, // Y position of the shot attempt
          value: 1,
          timestamp: 58.2,
        },
        {
          type: 'shotsOffTarget',
          x: 0.7, // X position of the shot attempt
          y: 0.2, // Y position of the shot attempt
          value: 2,
          timestamp: 58.2,
        },
      ],
      tackles: [
        {
          type: 'Successful Tackle',
          x: 0.3, // X position of the tackle
          y: 0.8, // Y position of the tackle
          value: 2,
          timestamp: 32.1,
        },
      ],
      goals: {
        type: 'goals',
        x: 0.3, // X position of the tackle
        y: 0.8, // Y position of the tackle
        value: 1,
        timestamp: 32.1,
      },
      assist: {
        type: 'assists',
        x: 0.3, // X position of the tackle
        y: 0.8, // Y position of the tackle
        value: 0,
        timestamp: 32.1,
      },
      totalTackles: {
        type: 'totalTackles',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      interceptions: {
        type: 'interceptions',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      clearance: {
        type: 'clearance',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      blockedShots: {
        type: 'blockedShots',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      aerialDuels: {
        type: 'aerialDuels',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      fouls: {
        type: 'fouls',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
    },
  },
  {
    playerId: '660ee3fa8d303e5be784cdbc',
    jerseyNumber: 7,
    name: 'Sterling Agabani',
    position: 'Midfielder',
    minutePlayed: 90,
    location: [
      {
        'x': 99.359375,
        'y': 61.734375,
      },
      {
        'x': 98.5,
        'y': 61.5234375,
      },
      {
        'x': 98.0703125,
        'y': 61.2734375,
      },
      {
        'x': 97.78125,
        'y': 61.140625,
      },
      {
        'x': 97.59765625,
        'y': 61.03515625,
      },
      {
        'x': 97.234375,
        'y': 60.85546875,
      },
      {
        'x': 96.65625,
        'y': 60.55859375,
      },
      {
        'x': 95.7265625,
        'y': 60.0859375,
      },
      {
        'x': 94.33203125,
        'y': 59.35546875,
      },
      {
        'x': 92.3046875,
        'y': 58.10546875,
      },
      {
        'x': 89.875,
        'y': 56.5625,
      },
      {
        'x': 87.47265625,
        'y': 54.9296875,
      },
      {
        'x': 85.2578125,
        'y': 53.19140625,
      },
      {
        'x': 83.60546875,
        'y': 51.8125,
      },
      {
        'x': 82.63671875,
        'y': 51.046875,
      },
      {
        'x': 82.0703125,
        'y': 50.625,
      },
      {
        'x': 81.76171875,
        'y': 50.41015625,
      },
      {
        'x': 81.58203125,
        'y': 50.34765625,
      },
      {
        'x': 81.34765625,
        'y': 50.34765625,
      },
      {
        'x': 80.96484375,
        'y': 50.34765625,
      },
      {
        'x': 80.66796875,
        'y': 50.3828125,
      },
      {
        'x': 80.00390625,
        'y': 50.6484375,
      },
      {
        'x': 79.046875,
        'y': 51.12109375,
      },
      {
        'x': 77.6171875,
        'y': 51.67578125,
      },
      {
        'x': 75.8359375,
        'y': 52.37890625,
      },
      {
        'x': 73.2265625,
        'y': 53.390625,
      },
      {
        'x': 70.16796875,
        'y': 54.37890625,
      },
      {
        'x': 67.24609375,
        'y': 55.05859375,
      },
      {
        'x': 64.3125,
        'y': 55.37890625,
      },
      {
        'x': 62.04296875,
        'y': 55.390625,
      },
      {
        'x': 60.5546875,
        'y': 55.390625,
      },
      {
        'x': 59.7109375,
        'y': 55.390625,
      },
      {
        'x': 59.4296875,
        'y': 55.390625,
      },
    ],
    actions: {
      shots: [
        {
          type: 'shotsOnTarget',
          x: 0.7, // X position of the shot attempt
          y: 0.2, // Y position of the shot attempt
          value: 1,
          timestamp: 58.2,
        },
        {
          type: 'shotsOffTarget',
          x: 0.7, // X position of the shot attempt
          y: 0.2, // Y position of the shot attempt
          value: 0,
          timestamp: 58.2,
        },
      ],
      tackles: [
        {
          type: 'SuccessfulTackle',
          x: 0.3, // X position of the tackle
          y: 0.8, // Y position of the tackle
          value: 3,
          timestamp: 32.1,
        },
      ],
      goals: {
        type: 'goals',
        x: 0.3, // X position of the tackle
        y: 0.8, // Y position of the tackle
        value: 0,
        timestamp: 32.1,
      },
      assist: {
        type: 'assists',
        x: 0.3, // X position of the tackle
        y: 0.8, // Y position of the tackle
        value: 0,
        timestamp: 32.1,
      },
      totalTackles: {
        type: 'totalTackles',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      interceptions: {
        type: 'interceptions',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      clearance: {
        type: 'clearance',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      blockedShots: {
        type: 'blockedShots',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      aerialDuels: {
        type: 'aerialDuels',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
      fouls: {
        type: 'fouls',
        x: 0.3,
        y: 0.8,
        value: 0,
        timestamp: 32.1,
      },
    },
  },
]


export type EventData = {
  playerId: string
  jerseyNumber: number
  name: string
  position: string
  minutePlayed: number
  location: LocationData[]
  actions: PlayerActions
}

export type LocationData = {
  x: number
  y: number
}

export type HeatSectorsType = {
  count: number
  x1: number
  x2: number
  y1: number
  y2: number
}

type PlayerActions = {
  shots: ActionData[]
  tackles: ActionData[]
  goals: ActionData
  assist: ActionData
  totalTackles: ActionData
  interceptions: ActionData
  clearance: ActionData
  blockedShots: ActionData
  aerialDuels: ActionData
  fouls: ActionData
}

export type ActionData = {
  type: string
  x?: number
  y?: number
  value: number
  timestamp: number
}


export const getPositionalData = (events: EventData[], playerId: string) => {
  const playerEvents = events.find(evt => evt.playerId === playerId)

  if (!playerEvents) {
    return []
  }

  return playerEvents.location.map(point => ({ x: point.x, y: point.y }))
}

export const getHeatmapSectors = (
  locations: LocationData[],
  noOfColumns: number,
  noOfRows: number,
) => {
  const sectorWidth = 120 / noOfColumns
  const sectorHeight = 80 / noOfRows

  const sectors = []
  let sector = 0
  let xCount = 0
  while (xCount < 120) {
    let yCount = 0
    while(yCount < 80) {
      sectors[sector] = {
        count: 0,
        x1: xCount,
        x2: xCount + sectorWidth,
        y1: yCount,
        y2: yCount + sectorHeight,
      }
      for(const loc of locations) {
        if((loc.x > xCount && loc.x < (xCount + sectorWidth)) &&
          (loc.y > yCount && loc.y <= (yCount + sectorHeight))) {
          sectors[sector].count++
        }
      }
      yCount += sectorHeight
      sector++
    }
    xCount += sectorWidth
    sector++
  }
  return sectors
}

export const getPlayerActions = (players: Player[], events: EventData[]) => {
  // Map player data to a lookup object for faster access by player ID
  const playerDataMap = events.reduce((acc, event) => {
    acc[event.playerId] = event.actions
    return acc
  }, {} as Record<string, PlayerActions>)

  // Loop through players and retrieve actions (handling missing data)
  return players.map(player => {
    const actions = playerDataMap[player.id]
    return {
      playerId: player.id,
      name: player.firstName + ' ' + player.lastName,
      jerseyNum: player.uniformNumber,
      position: player.position,
      actions: actions,
    }
  })
}
